<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Copydesk – Translation Subjob</title>

  <!-- Ascend design system + app shell -->
  <link rel="stylesheet" href="../../assets/ascend.css">
  <link rel="stylesheet" href="../../assets/ascend-apps.css">

  <!-- Copydesk-only visuals/layout (keep for consistency) -->
  <link rel="stylesheet" href="assets/css/copydesk.css">

  <!-- Copydesk font (scoped; does NOT affect Ascend chrome) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:opsz,wght@8..60,200..900&display=swap" rel="stylesheet">

  <!-- Authoritative styles injected by backend (res.stylesCss) -->
  <style id="copydesk-styles-css"></style>

  <style>
    /* Fallback font surface rules (same intent as seed) */
    .subjob-rows .subjob-english,
    .subjob-rows textarea {
      font-family: "Source Sans 3", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
  </style>

  <!-- Load Overlay (Copydesk) -->
  <style>
    #load-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.72);
      backdrop-filter: blur(2px);
      z-index: 9999;
    }
    #load-overlay.is-on { display: flex; }

    .load-overlay__panel {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(0, 0, 0, 0.10);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
      max-width: min(520px, calc(100vw - 40px));
    }
    .load-overlay__spinner {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid rgba(0, 0, 0, 0.18);
      border-top-color: rgba(0, 0, 0, 0.62);
      animation: loadspin 0.9s linear infinite;
      flex: 0 0 auto;
    }
    .load-overlay__text {
      font: 500 14px/1.25 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color: rgba(0, 0, 0, 0.78);
      user-select: none;
      -webkit-user-select: none;
      word-break: break-word;
    }
    @keyframes loadspin { to { transform: rotate(360deg); } }
  </style>

  <style>
    /* -----------------------------
       Subjob layout (80/20, no horiz scroll)
    ----------------------------- */

    /* Keep within existing Copydesk content area */
    .copydesk-content { padding-bottom: 20px; }

    .subjob-columns {
      display: block; /* the per-segment rows (.subjob-row) manage the 80/20 grid */
      width: 100%;
      max-width: 100%;
    }

    .subjob-rows {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 100%;
    }

    /* Each row is two “cards”: left translation card + right notes card */
    .subjob-row {
      display: grid;
      grid-template-columns: 4fr 1fr; /* 80/20 */
      gap: 16px;
      align-items: stretch;           /* make left + right end together */
      width: 100%;
      max-width: 100%;
      padding: 12px;
      border-radius: 14px;
    }

    /* Alternating row tones for visual clarity */
    .subjob-row:nth-child(odd)  { background: rgba(0,0,0,0.00); }
    .subjob-row:nth-child(even) { background: rgba(0,0,0,0.03); }

    @media (max-width: 980px) {
      .subjob-row { grid-template-columns: 1fr; }
    }

    /* Cards fill row height so notes aligns with stacked left content */
    .subjob-card {
    padding: 12px;
    min-width: 0;
    height: 100%;
    display: flex;
    flex-direction: column;
  }

    .subjob-card__label {
      font-size: 0.78rem;
      font-weight: 500;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--ascend-app-label);
      margin: 2px 0 10px 2px;
      opacity: 1;
    }

    /* Left stacked arrangement */
    .subjob-english {
      background: rgba(255,255,255,0.92);
      border: 1px solid var(--ascend-app-border);
      border-radius: 16px;
      padding: 12px;
      box-shadow:
        0 1px 0 rgba(15, 23, 42, 0.04),
        0 14px 42px rgba(15, 23, 42, 0.08);

      white-space: pre-wrap;
      overflow-wrap: break-word;
      word-break: normal;
      min-width: 0;

      cursor: default;
    }

    .subjob-textarea {
      width: 100%;
      display: block;
      min-height: 84px;
      resize: vertical;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.14);
      background: #fff;
      color: rgba(0,0,0,0.88);
      line-height: 1.35;
      outline: none;
      min-width: 0;
      flex: 1 1 auto;
    }

    .subjob-textarea:focus {
      border-color: rgba(0,0,0,0.28);
    }

    .subjob-stack {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 0;
    }

    /* Small segment index chip */
    .subjob-segmeta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }

    .subjob-chip {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,0.05);
      border: 1px solid rgba(0,0,0,0.08);
      opacity: 0.85;
      white-space: nowrap;
    }

    /* Status bar (reuse existing element/id) */
    .status-bar {
      margin-top: 14px;
      font-size: 13px;
      opacity: 0.88;
    }

    .status-ok { color: rgba(0,0,0,0.70); }
    .status-saving { color: rgba(0,0,0,0.78); }
    .status-error { color: rgba(180, 0, 0, 0.85); }

    /* Segment Divider rows (JS should add .is-divider on the .subjob-row) */
        .subjob-row.is-divider {
      background: transparent;
      padding: 0;
    }
    .subjob-row.is-divider .seg-label {
      display: none;
    }
    .subjob-row.is-divider textarea {
      display: none;
    }
    .subjob-row.is-divider .committed-seg {
      display: block;
      margin: 6px 0;
    }
    .subjob-divider {
      display: block;
      height: 2px;
      width: 100%;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.28);
      margin: 10px 0;
    }
  </style>
</head>

<body class="ascend-app-body">

  <!-- Load Overlay (Copydesk) -->
  <div id="load-overlay" aria-live="polite" aria-busy="true" role="status">
    <div class="load-overlay__panel">
      <div class="load-overlay__spinner" aria-hidden="true"></div>
      <div id="load-overlay-text" class="load-overlay__text">Loading…</div>
    </div>
  </div>

  <div class="ascend-app-shell">
    <div class="ascend-app-panel">

      <header class="ascend-app-header">

        <!-- LEFT: app label + filename -->
        <div class="ascend-app-title-block" style="display:flex; align-items:baseline; gap:28px;">
          <div class="ascend-app-title" style="font-weight:200; letter-spacing:0.18em;">COPYDESK</div>
          <div id="job-name" class="ascend-app-subtitle"></div>
        </div>

        <!-- RIGHT: translator identity only -->
        <div class="ascend-app-meta" style="display:flex; flex-direction:column; align-items:flex-end; gap:6px;">
          <div id="job-collaborators" style="opacity:0.85;"></div>
        </div>

        <!-- FAR RIGHT: NO PUSH (translation-only tranche) -->
        <div class="ascend-app-actions">
          <button id="subjob-finish-btn" type="button">
            Finish
          </button>
        </div>

      </header>

      <main class="copydesk-content">
        <div class="subjob-columns">

        <!-- Column headers -->
        <div class="subjob-row" style="padding:0; background:none;">
          <div class="copydesk-col-title" style="margin: 0 0 10px 2px;">TRANSLATION</div>
          <div class="copydesk-col-title" style="margin: 0 2px 10px 2px; text-align:left;">TRANSLATOR NOTES</div>
        </div>

        <!-- Rows -->
        <div>
          <div id="subjob-rows" class="subjob-rows committed-list"></div>

          <p id="segments-empty" class="empty-state" style="display:none;">
            No segments yet for this job.
          </p>
        </div>

      </div>

        <div id="status-bar" class="status-bar status-ok">Ready.</div>
      </main>

      <script>
        window.COPYDESK_API_BASE = window.COPYDESK_API_BASE || 'https://script.google.com/macros/s/AKfycbwW7nb_iJiZJBKeUIQtpp_GOY4tnLQidefDyOHqZDpQkfMympH2Ip4kvgv8bE1or9O9/exec';
      </script>

    </div>
  </div>

  <!-- API client + Translation-only view -->
  <script defer src="assets/js/copydesk_api_client.js"></script>
  <script defer src="assets/js/copydesk_subjob_view.js"></script>

</body>
</html>

